<!DOCTYPE html>
<html lang="id" x-data="ttsApp()" x-init="init()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panggilan Monse System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --border-radius: 10px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--dark) 0%, #374151 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .logo h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .subtitle {
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        .header-controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .server-status {
            padding: 8px 15px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .server-status.connected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .server-status.disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .client-id {
            background: rgba(59, 130, 246, 0.2);
            padding: 8px 15px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
        }

        /* Master Control Panel */
        .master-control-panel {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            margin: 20px;
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid #bae6fd;
        }

        .panel-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        .client-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-body {
            padding: 20px;
        }

        .master-request {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .master-info {
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 4px solid var(--warning);
        }

        .btn-master {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            max-width: 200px;
        }

        .btn-master:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .master-active {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .master-badge {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            padding: 20px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid #fed7aa;
        }

        .master-badge i {
            font-size: 2rem;
            color: #f59e0b;
        }

        .master-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            background: #f9fafb;
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2, .card-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .card-body {
            padding: 20px;
        }

        /* Input Section */
        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            resize: vertical;
            transition: var(--transition);
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .char-count {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .text-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--gray) 0%, #4b5563 100%);
            color: white;
        }

        .btn-outline {
            background: white;
            border: 2px solid var(--gray-light);
            color: var(--dark);
        }

        .btn-convert {
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            flex: 1;
            justify-content: center;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .setting label {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .select-input {
            padding: 10px 15px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            background: white;
            font-size: 1rem;
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, var(--gray-light), var(--primary));
            border-radius: 4px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: var(--shadow);
        }

        /* Clients Section */
        .clients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .client-card {
            background: white;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .client-card.master {
            border-color: var(--warning);
            background: #fffbeb;
        }

        .client-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--gray);
        }

        .client-avatar.master {
            background: #fef3c7;
            color: var(--warning);
        }

        /* Audio Player */
        .audio-player {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .audio-element {
            width: 100%;
            border-radius: var(--border-radius);
        }

        .audio-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            background: #f9fafb;
            padding: 15px;
            border-radius: var(--border-radius);
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Notifications */
        .notifications-section {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 350px;
        }

        .notification {
            background: white;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: flex-start;
            gap: 15px;
            border-left: 4px solid var(--gray);
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            border-left-color: var(--secondary);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification.info {
            border-left-color: var(--primary);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* History */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            padding: 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item.success {
            background: #f0fdf4;
            border-color: #86efac;
        }

        .history-item.error {
            background: #fef2f2;
            border-color: #fca5a5;
        }

        /* Status Grid */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-item i {
            font-size: 2rem;
            color: var(--primary);
        }

        /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            padding: 20px 30px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer-note {
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        .footer-links {
            display: flex;
            gap: 20px;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--gray-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-link:hover {
            color: white;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: var(--dark);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .btn-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .clients-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            
            .master-controls {
                flex-direction: column;
            }
            
            .btn-convert {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-volume-up"></i>
                <div>
                    <h1>Panggilan Monse System</h1>
                    <p class="subtitle">Output audio terpusat dari satu komputer</p>
                </div>
            </div>
            <div class="header-controls">
                <div class="server-status" :class="serverStatus">
                    <i class="fas" :class="{
                        'fa-wifi': serverStatus === 'connected',
                        'fa-wifi-slash': serverStatus === 'disconnected',
                        'fa-exclamation-triangle': serverStatus === 'error'
                    }"></i>
                    <span x-text="serverStatusText"></span>
                </div>
                <div class="client-id" x-show="clientId">
                    <i class="fas fa-id-card"></i>
                    <span>ID: <span x-text="clientIdShort"></span></span>
                </div>
            </div>
        </header>

        <!-- Master Control Panel -->
        <section class="master-control-panel" x-show="clientId">
            <div class="panel-header">
                <h3><i class="fas fa-crown"></i> Kontrol Master</h3>
                <div class="client-count">
                    <i class="fas fa-users"></i>
                    <span x-text="connectedClients.length"></span> komputer terhubung
                </div>
            </div>
            
            <div class="panel-body">
                <div x-show="!isMaster" class="master-request">
                    <div class="master-info">
                        <i class="fas fa-info-circle"></i>
                        <p>Status: <strong>Client Biasa</strong> - Anda dapat mengirim teks, tetapi hanya Master yang memutar audio.</p>
                    </div>
                    <button @click="requestMasterRole()" 
                            :disabled="isRequestingMaster || isMaster" 
                            class="btn btn-success btn-master">
                        <i class="fas fa-crown"></i>
                        <span x-text="isRequestingMaster ? 'Meminta...' : 'Jadikan Master'"></span>
                    </button>
                    <p class="hint">* Master akan menerima dan memutar audio dari semua komputer</p>
                </div>
                
                <div x-show="isMaster" class="master-active">
                    <div class="master-badge">
                        <i class="fas fa-crown"></i>
                        <div>
                            <h4>Anda adalah Master Controller</h4>
                            <p>Audio akan diputar di komputer ini. Semua komputer lain mengirim teks ke Anda.</p>
                        </div>
                    </div>
                    <div class="master-controls">
                        <button @click="playAudio()" 
                                :disabled="!currentAudio || isPlaying" 
                                class="btn btn-primary">
                            <i class="fas fa-play"></i> Putar Audio
                        </button>
                        <button @click="pauseAudio()" 
                                :disabled="!isPlaying" 
                                class="btn btn-warning">
                            <i class="fas fa-pause"></i> Jeda
                        </button>
                        <button @click="stopAudio()" 
                                :disabled="!currentAudio" 
                                class="btn btn-secondary">
                            <i class="fas fa-stop"></i> Stop
                        </button>
                        <button @click="releaseMasterRole()" 
                                class="btn btn-outline">
                            <i class="fas fa-sign-out-alt"></i> Lepaskan Peran Master
                        </button>
                    </div>
                    <div class="master-stats" x-show="currentAudio">
                        <div class="stat">
                            <i class="fas fa-clock"></i>
                            <span>Durasi: <strong x-text="currentAudio?.duration + ' detik'"></strong></span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-microphone"></i>
                            <span>Dari: <strong x-text="currentAudio?.fromClientId || 'Unknown'"></strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Connected Clients -->
        <section x-show="connectedClients.length > 1" class="card clients-section">
            <div class="card-header">
                <h3><i class="fas fa-network-wired"></i> Komputer Terhubung</h3>
                <span class="badge" x-text="connectedClients.length"></span>
            </div>
            <div class="card-body">
                <div class="clients-grid">
                    <template x-for="client in connectedClients" :key="client.id">
                        <div class="client-card" :class="{ 'master': client.isMaster }">
                            <div class="client-avatar" :class="{ 'master': client.isMaster }">
                                <i class="fas" :class="client.isMaster ? 'fa-crown' : 'fa-desktop'"></i>
                            </div>
                            <div class="client-info">
                                <h4 x-text="client.id.substring(0, 12)"></h4>
                                <p :class="{ 'master': client.isMaster }" 
                                   x-text="client.isMaster ? 'Master Controller' : 'Client'"></p>
                                <small x-text="formatTime(client.joinedAt)"></small>
                            </div>
                            <div class="client-status" :class="{ 'online': true, 'master': client.isMaster }">
                                <i class="fas fa-circle"></i>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </section>

        <main class="main-content">
            <!-- Input Section -->
            <section class="card input-section">
                <div class="card-header">
                    <h2><i class="fas fa-keyboard"></i> Input Teks</h2>
                    <div class="char-count">
                        <span x-text="charCount"></span>/<span x-text="maxChars"></span> karakter
                        <span x-show="wordCount > 0">â€¢ <span x-text="wordCount"></span> kata</span>
                    </div>
                </div>
                <div class="card-body">
                    <textarea x-model="text"
                              @input="updateCharCount()"
                              placeholder="Ketik atau tempel teks yang ingin diubah menjadi suara... (Audio akan diputar di komputer Master)"
                              rows="4"
                              :maxlength="maxChars"
                              :class="{'has-error': charCount >= maxChars}"
                              class="text-input"></textarea>

                    <div class="text-actions">
                        <button @click="clearText()" class="btn btn-outline">
                            <i class="fas fa-trash-alt"></i> Hapus
                        </button>
                        <button @click="pasteText()" class="btn btn-outline">
                            <i class="fas fa-paste"></i> Tempel
                        </button>
                        <button @click="convertToSpeech()" 
                                :disabled="isLoading || !text || isMaster && !isMasterReady"
                                class="btn btn-primary btn-convert">
                            <i class="fas" :class="isLoading ? 'fa-spinner fa-spin' : 'fa-paper-plane'"></i>
                            <span x-text="getConvertButtonText()"></span>
                        </button>
                        
                        <button @click="convertAndBroadcast()" 
                                :disabled="isLoading || !text || !isMaster"
                                x-show="isMaster"
                                class="btn btn-success">
                            <i class="fas fa-broadcast-tower"></i>
                            <span>Kirim ke Semua</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="card settings-section">
                <div class="card-header">
                    <h2><i class="fas fa-sliders-h"></i> Pengaturan</h2>
                </div>
                <div class="card-body">
                    <div class="settings-grid">
                        <div class="setting">
                            <label for="language">
                                <i class="fas fa-language"></i> Bahasa
                            </label>
                            <select id="language" x-model="language" class="select-input">
                                <option value="" disabled>Pilih bahasa...</option>
                                <template x-for="lang in languages" :key="lang.code">
                                    <option :value="lang.code" x-text="`${lang.name} (${lang.nativeName})`"></option>
                                </template>
                            </select>
                        </div>

                        <div class="setting">
                            <label for="speed">
                                <i class="fas fa-tachometer-alt"></i> Kecepatan
                                <span class="speed-value" x-text="`${speed}x`"></span>
                            </label>
                            <div class="slider-container">
                                <input type="range" id="speed" x-model="speed" 
                                       min="0.5" max="2" step="0.1" class="slider">
                                <div class="slider-labels">
                                    <span>Lambat (0.5x)</span>
                                    <span>Normal (1.0x)</span>
                                    <span>Cepat (2.0x)</span>
                                </div>
                            </div>
                        </div>

                        <div class="setting">
                            <label for="priority">
                                <i class="fas fa-flag"></i> Prioritas
                            </label>
                            <select id="priority" x-model="priority" class="select-input">
                                <option value="low">Rendah</option>
                                <option value="normal">Normal</option>
                                <option value="high">Tinggi</option>
                                <option value="urgent">Sangat Penting</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Audio Player Section (Master Only) -->
            <section x-show="isMaster && currentAudio" class="card audio-section">
                <div class="card-header">
                    <h3><i class="fas fa-music"></i> Pemutar Audio (Master)</h3>
                    <div class="audio-source" x-show="currentAudio?.fromClientId">
                        <i class="fas fa-user"></i>
                        <span>Dari: <strong x-text="currentAudio?.fromClientId"></strong></span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="audio-player">
                        <audio id="masterAudioPlayer" 
                               :src="currentAudio?.audioUrl" 
                               controls
                               @play="onAudioPlay()"
                               @pause="onAudioPause()"
                               @ended="onAudioEnd()"
                               class="audio-element"></audio>
                        
                        <div class="audio-info">
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <span>Durasi: <strong x-text="currentAudio?.duration + ' detik'"></strong></span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-language"></i>
                                <span>Bahasa: <strong x-text="getLanguageName(currentAudio?.language)"></strong></span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-text-height"></i>
                                <span>Karakter: <strong x-text="currentAudio?.textLength"></strong></span>
                            </div>
                        </div>
                        
                        <div class="audio-actions">
                            <button @click="downloadAudio()" class="btn btn-outline">
                                <i class="fas fa-download"></i> Unduh
                            </button>
                            <button @click="shareAudio()" class="btn btn-outline">
                                <i class="fas fa-share-alt"></i> Bagikan
                            </button>
                            <button @click="clearAudio()" class="btn btn-outline">
                                <i class="fas fa-times"></i> Hapus
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Notification Section -->
            <section x-show="notifications.length > 0" class="notifications-section">
                <div class="notifications-container">
                    <template x-for="notification in notifications.slice().reverse().slice(0, 3)" :key="notification.id">
                        <div class="notification" :class="notification.type" @click="removeNotification(notification.id)">
                            <i class="fas" :class="getNotificationIcon(notification.type)"></i>
                            <div class="notification-content">
                                <p x-text="notification.message"></p>
                                <small x-text="formatTime(notification.timestamp)"></small>
                            </div>
                            <button @click="removeNotification(notification.id)" class="btn-close">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </template>
                </div>
            </section>

            <!-- History Section -->
            <section x-show="history.length > 0" class="card history-section">
                <div class="card-header">
                    <h3><i class="fas fa-history"></i> Riwayat Pengiriman</h3>
                    <button @click="clearHistory()" class="btn btn-small">
                        <i class="fas fa-trash"></i> Hapus Semua
                    </button>
                </div>
                <div class="card-body">
                    <div class="history-list">
                        <template x-for="(item, index) in history.slice().reverse()" :key="item.id">
                            <div class="history-item" :class="{ 'success': item.success, 'error': !item.success }">
                                <div class="history-content">
                                    <div class="history-text" x-text="truncateText(item.text, 80)"></div>
                                    <div class="history-meta">
                                        <span><i class="fas fa-language"></i> <span x-text="getLanguageCode(item.language)"></span></span>
                                        <span><i class="fas fa-clock"></i> <span x-text="formatTime(item.timestamp)"></span></span>
                                        <span><i class="fas" :class="item.success ? 'fa-check-circle' : 'fa-times-circle'"></i></span>
                                    </div>
                                </div>
                                <div class="history-actions">
                                    <button @click="loadHistoryItem(item)" class="btn btn-small">
                                        <i class="fas fa-redo"></i> Gunakan Lagi
                                    </button>
                                    <button @click="removeHistoryItem(item.id)" class="btn btn-small btn-outline">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </section>

            <!-- System Status -->
            <section class="card status-section">
                <div class="card-header">
                    <h3><i class="fas fa-chart-line"></i> Status Sistem</h3>
                </div>
                <div class="card-body">
                    <div class="status-grid">
                        <div class="status-item">
                            <i class="fas fa-server"></i>
                            <div>
                                <h4>Server</h4>
                                <p x-text="serverStatus === 'connected' ? 'Aktif' : 'Tidak Aktif'"></p>
                            </div>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-users"></i>
                            <div>
                                <h4>Klien Terhubung</h4>
                                <p x-text="connectedClients.length"></p>
                            </div>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-crown"></i>
                            <div>
                                <h4>Master</h4>
                                <p x-text="isMaster ? 'Anda' : masterClientId || 'Tidak Ada'"></p>
                            </div>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-history"></i>
                            <div>
                                <h4>Riwayat</h4>
                                <p x-text="history.length + ' item'"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-info">
                    <p>TTS Multi-Client System v2.0 &copy; 2024</p>
                    <p class="footer-note">Sistem Text-to-Speech dengan output audio terpusat</p>
                </div>
                <div class="footer-links">
                    <button @click="showSystemInfo()" class="btn-link">
                        <i class="fas fa-info-circle"></i> Info Sistem
                    </button>
                    <button @click="testConnection()" class="btn-link">
                        <i class="fas fa-wifi"></i> Test Koneksi
                    </button>
                    <button @click="showHelp()" class="btn-link">
                        <i class="fas fa-question-circle"></i> Bantuan
                    </button>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div x-show="showSystemInfoModal" class="modal-overlay" @click.self="showSystemInfoModal = false">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> Informasi Sistem</h3>
                <button @click="showSystemInfoModal = false" class="btn-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="system-info">
                    <h4>TTS Multi-Client System v2.0</h4>
                    <p>Sistem ini memungkinkan beberapa komputer mengirim teks untuk dikonversi menjadi suara, tetapi output audio hanya dari satu komputer (Master Controller).</p>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <strong><i class="fas fa-user-crown"></i> Master Controller:</strong>
                            <p>Komputer yang memutar audio. Hanya satu master yang aktif.</p>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-desktop"></i> Client Biasa:</strong>
                            <p>Komputer yang hanya mengirim teks. Tidak memutar audio.</p>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-broadcast-tower"></i> Broadcast:</strong>
                            <p>Master dapat mengirim audio ke semua komputer.</p>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-history"></i> Antrian:</strong>
                            <p>Teks dikirim saat tidak ada master akan masuk antrian.</p>
                        </div>
                    </div>
                    
                    <h5>Alur Kerja:</h5>
                    <ol>
                        <li>Klien terhubung ke server</li>
                        <li>Satu klien menjadi Master</li>
                        <li>Klien lain mengirim teks</li>
                        <li>Server konversi teks ke audio</li>
                        <li>Audio dikirim ke Master</li>
                        <li>Master memutar audio</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <div x-show="showHelpModal" class="modal-overlay" @click.self="showHelpModal = false">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-question-circle"></i> Panduan Penggunaan</h3>
                <button @click="showHelpModal = false" class="btn-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="help-content">
                    <h4>Cara Menggunakan:</h4>
                    
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h5>Persiapan</h5>
                            <p>Pastikan semua komputer terhubung ke jaringan yang sama. Buka alamat server di semua browser.</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h5>Menentukan Master</h5>
                            <p>Di komputer yang memiliki speaker (output audio), klik "Jadikan Master". Komputer ini akan memutar semua audio.</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h5>Mengirim Teks</h5>
                            <p>Di komputer lain (client biasa), masukkan teks, pilih bahasa, dan klik "Kirim ke Master". Audio akan diputar di komputer Master.</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h5>Broadcast (Opsional)</h5>
                            <p>Master dapat mengirim audio ke semua komputer dengan klik "Kirim ke Semua".</p>
                        </div>
                    </div>
                    
                    <h5>Troubleshooting:</h5>
                    <ul>
                        <li><strong>Audio tidak keluar:</strong> Pastikan komputer Master memiliki speaker aktif dan volume cukup.</li>
                        <li><strong>Tidak bisa jadi Master:</strong> Hanya satu Master yang aktif. Tunggu atau minta Master saat ini melepaskan peran.</li>
                        <li><strong>Koneksi terputus:</strong> Refresh halaman atau periksa jaringan.</li>
                        <li><strong>Teks tidak terkirim:</strong> Pastikan ada Master yang aktif dan teks tidak kosong.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Element (Hidden) -->
    <audio id="hiddenAudio" style="display: none;"></audio>
</body>
</html>
